<% if (title) { %>
  <h1><%= title %></h1>
<% } else { %>
  <h1>Inbox</h1>
<% } %>

<%- messages() %>

<div class="message-navigation">
  <a href="/messages/compose" class="btn btn-primary">✉️ Compose New Message</a>
  <a href="/messages/sent">
    📤 Sent Messages
    <% if (sentCount > 0) { %>
      (<%= sentCount %>)
    <% } %>
  </a>
  <a href="/messages/archived">
    📁 Archived Messages
    <% if (archivedCount > 0) { %>
      (<%= archivedCount %>)
    <% } %>
  </a>
  <a href="/account/">← Back to Account</a>
</div>

<div class="message-list">
  <% if (messageList && messageList.length > 0) { %>
    <table class="message-table">
      <thead>
        <tr>
          <th>Status</th>
          <th>From</th>
          <th>Subject</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% messageList.forEach(message => { %>
          <tr class="<%= message.message_read ? 'read' : 'unread' %>">
            <td>
              <% if (message.message_read) { %>
                <span class="status-badge read-badge">Read</span>
              <% } else { %>
                <span class="status-badge unread-badge">Unread</span>
              <% } %>
            </td>
            <td><%= message.sender_name %></td>
            <td>
              <a href="/messages/read/<%= message.message_id %>">
                <%= message.message_subject %>
              </a>
            </td>
            <td><%= new Date(message.message_created).toLocaleString() %></td>
            <td class="message-actions">
              <a href="/messages/read/<%= message.message_id %>" class="btn btn-sm">Read</a>
              <% if (!message.message_read) { %>
                <form action="/messages/mark-read/<%= message.message_id %>" method="post" style="display:inline;">
                  <button type="submit" class="btn btn-sm">Mark Read</button>
                </form>
              <% } else { %>
                <form action="/messages/mark-unread/<%= message.message_id %>" method="post" style="display:inline;">
                  <button type="submit" class="btn btn-sm">Mark Unread</button>
                </form>
              <% } %>
              <form action="/messages/archive/<%= message.message_id %>" method="post" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-warning">Archive</button>
              </form>
              <form action="/messages/delete/<%= message.message_id %>" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this message?');">
                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <div class="no-messages">
      <p>📭 No messages in your inbox.</p>
      <p><a href="/messages/compose" class="btn btn-primary">Compose your first message</a></p>
    </div>
  <% } %>
</div>